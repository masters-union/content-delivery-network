class LoadWidget{constructor(e){this.widgetId=e,this.iframeLoaded=!1,this.init()}init(){"complete"===document.readyState||"interactive"===document.readyState?this.loadIframe():document.addEventListener("DOMContentLoaded",(()=>this.loadIframe()));new MutationObserver((()=>{this.iframeLoaded||this.loadIframe()})).observe(document.body,{childList:!0,subtree:!0}),window.loadWidgetListener||(window.loadWidgetListener=!0,window.widgetMessageHandler=this.handleMessage.bind(this),window.addEventListener("message",window.widgetMessageHandler))}loadIframe(){const e=document.getElementById(this.widgetId);if(!e||this.iframeLoaded)return;this.iframeLoaded=!0,e.setAttribute("frameBorder","0");let t=`https://widget.mastersunion.org/widget/${this.widgetId}`;const a=new URLSearchParams(window.location.search);a.append("widgetHostURL",window.location.href),a.append("parentReferrer",document.referrer||window.location.href||""),e.setAttribute("allow","autoplay; camera; microphone; fullscreen; display-capture"),e.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"),e.src=`${t}?${a.toString()}`}handleMessage(e){if(["https://widget.mastersunion.org","http://localhost:7010"].includes(e.origin)){if("REDIRECT"===e.data?.type&&e.data?.url&&(window.location.href=e.data.url),"RESIZE"===e.data?.type&&e.data?.height){const t=document.getElementById(e.data.widgetId);t&&(t.style.height=`${e.data.height}px`)}}else console.warn("Message received from unauthorized origin:",e.origin)}}
